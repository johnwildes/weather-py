<!-- Enhanced Location Management Toolbar - Phase 4 -->
<div class="zipcode-toolbar">
    <fluent-card class="toolbar-card">
        <div class="toolbar-content">
            <!-- Section Header with Location Count -->
            <div class="section-header">
                <div class="section-label">Location Management</div>
                <div class="location-stats">
                    <span id="locationCount">0/10</span> locations selected
                </div>
            </div>

            <!-- Location Input Section with Enhanced Autocomplete -->
            <div class="input-section">
                <div class="location-input-container">
                    <fluent-text-field 
                        id="zipcodeInput" 
                        placeholder="Enter ZIP code, city name, or coordinates..."
                        appearance="filled"
                        size="300">
                        <fluent-icon slot="start" name="Location24Regular"></fluent-icon>
                    </fluent-text-field>
                    
                    <!-- Enhanced autocomplete dropdown -->
                    <div class="autocomplete-dropdown" id="autocompleteDropdown" hidden>
                        <div class="autocomplete-results" id="autocompleteResults">
                            <!-- Autocomplete suggestions populated by Phase 4 API -->
                        </div>
                    </div>
                </div>
                
                <fluent-button 
                    id="addLocationBtn" 
                    appearance="accent">
                    <fluent-icon slot="start" name="Add24Regular"></fluent-icon>
                    Add Location
                </fluent-button>
                
                <fluent-button 
                    id="currentLocationBtn" 
                    appearance="outline">
                    <fluent-icon slot="start" name="MyLocation24Regular"></fluent-icon>
                    Current Location
                </fluent-button>
            </div>

            <!-- Enhanced Selected Locations Display -->
            <div class="selected-locations">
                <div class="section-header">
                    <div class="section-label">Selected Locations</div>
                    <div class="location-status">
                        <div class="status-dot" id="loadingStatus"></div>
                        <span id="statusText">Ready</span>
                    </div>
                </div>
                
                <!-- Location badges with enhanced actions -->
                <div class="location-badges" id="locationBadges">
                    <!-- Populated by enhanced state manager -->
                </div>
            </div>

            <!-- Enhanced Data Management -->
            <div class="data-management">
                <fluent-button 
                    id="refreshBtn" 
                    appearance="accent"
                    disabled>
                    <fluent-icon slot="start" name="ArrowClockwise24Regular"></fluent-icon>
                    Refresh All
                </fluent-button>
                
                <fluent-menu-button 
                    id="moreActionsBtn"
                    appearance="stealth">
                    <fluent-icon slot="start" name="MoreVertical24Regular"></fluent-icon>
                    More Actions
                    
                    <fluent-menu slot="menu">
                        <fluent-menu-item onclick="window.weatherApp?.clearAllLocations()">
                            <fluent-icon slot="start" name="Delete24Regular"></fluent-icon>
                            Clear All Locations
                        </fluent-menu-item>
                        <fluent-menu-item onclick="window.weatherApp?.exportSettings()">
                            <fluent-icon slot="start" name="ArrowDownload24Regular"></fluent-icon>
                            Export Settings
                        </fluent-menu-item>
                        <fluent-menu-item onclick="document.getElementById('importFileInput').click()">
                            <fluent-icon slot="start" name="ArrowUpload24Regular"></fluent-icon>
                            Import Settings
                        </fluent-menu-item>
                    </fluent-menu>
                </fluent-menu-button>
                
                <!-- Hidden file input for import -->
                <input type="file" id="importFileInput" accept=".json" style="display: none;" 
                       onchange="handleSettingsImport(this.files[0])">
            </div>

            <!-- User Preferences -->
            <div class="preferences-section">
                <div class="control-group">
                    <label for="tempUnitToggle">Temperature Unit:</label>
                    <fluent-switch id="tempUnitToggle">
                        <span slot="checked-message">°F</span>
                        <span slot="unchecked-message">°C</span>
                    </fluent-switch>
                </div>
                
                <div class="control-group">
                    <label for="viewToggle">View Mode:</label>
                    <fluent-switch id="viewToggle">
                        <span slot="checked-message">Table</span>
                        <span slot="unchecked-message">Grid</span>
                    </fluent-switch>
                </div>

                <div class="control-group">
                    <label for="autoRefreshToggle">Auto Refresh:</label>
                    <fluent-switch id="autoRefreshToggle" checked>
                        <span slot="checked-message">On</span>
                        <span slot="unchecked-message">Off</span>
                    </fluent-switch>
                </div>
            </div>

            <!-- Auto-refresh indicator -->
            <div class="auto-refresh-indicator" id="autoRefreshIndicator" style="display: none;">
                <fluent-icon name="ArrowClockwise16Regular"></fluent-icon>
                <span>Auto-refresh in</span>
                <span class="refresh-countdown" id="refreshCountdown">5:00</span>
            </div>
        </div>
    </fluent-card>
</div>

<!-- Phase 4 Integration Scripts -->
<script>
// Enhanced toolbar integration functions
function handleSettingsImport(file) {
    if (window.weatherApp && file) {
        window.weatherApp.importSettings(file);
    }
}

// Initialize toolbar when DOM is ready
document.addEventListener('DOMContentLoaded', function() {
    // Auto-refresh toggle handler
    const autoRefreshToggle = document.getElementById('autoRefreshToggle');
    if (autoRefreshToggle && window.weatherApp?.stateManager) {
        autoRefreshToggle.addEventListener('change', (e) => {
            window.weatherApp.stateManager.updatePreference('autoRefresh', e.target.checked);
        });
    }

    // Setup refresh countdown display
    if (window.weatherApp?.stateManager) {
        window.weatherApp.stateManager.on('autoRefreshTriggered', () => {
            updateRefreshCountdown();
        });
    }
});

function updateRefreshCountdown() {
    const countdownElement = document.getElementById('refreshCountdown');
    const indicatorElement = document.getElementById('autoRefreshIndicator');
    
    if (!countdownElement || !indicatorElement) return;
    
    const refreshInterval = window.weatherApp?.stateManager?.getUserPreferences()?.refreshInterval || 300000;
    let remaining = refreshInterval / 1000;
    
    indicatorElement.style.display = 'flex';
    
    const updateTimer = setInterval(() => {
        const minutes = Math.floor(remaining / 60);
        const seconds = remaining % 60;
        countdownElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
        
        remaining--;
        
        if (remaining < 0) {
            clearInterval(updateTimer);
            indicatorElement.style.display = 'none';
        }
    }, 1000);
}
</script>
